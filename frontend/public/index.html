<!doctype html>
<html lang="de">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <meta name="theme-color" content="#78716c" />
        <meta name="description" content="Digitale Auftragsverwaltung f√ºr Steinmetzbetriebe - PDF Upload und Suchfunktionen" />
        
        <!-- PWA Meta Tags -->
        <meta name="application-name" content="Steinmetz App" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta name="apple-mobile-web-app-title" content="Steinmetz App" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="msapplication-config" content="/browserconfig.xml" />
        <meta name="msapplication-TileColor" content="#78716c" />
        <meta name="msapplication-tap-highlight" content="no" />
        
        <!-- Favicon und Icons -->
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#78716c" />
        <link rel="shortcut icon" href="/favicon.ico" />
        
        <!-- Manifest -->
        <link rel="manifest" href="/manifest.json" />
        
        <title>Steinmetz Auftragsverwaltung</title>
        
        <!-- Preload wichtige Ressourcen -->
        <link rel="preload" href="https://images.unsplash.com/photo-1652305461546-bf0a76934433?crop=entropy&cs=srgb&fm=jpg&ixid=M3w3NTY2NzB8MHwxfHNlYXJjaHwxfHxncmFuaXRlfGVufDB8fHx8MTc1MzE5NDQyM3ww&ixlib=rb-4.1.0&q=85" as="image" />
    </head>
    <body>
        <noscript>
            <div style="text-align: center; padding: 50px; font-family: Arial, sans-serif;">
                <h2>JavaScript erforderlich</h2>
                <p>Diese App ben√∂tigt JavaScript um zu funktionieren. Bitte aktivieren Sie JavaScript in Ihren Browser-Einstellungen.</p>
            </div>
        </noscript>
        
        <div id="root"></div>
        
        <!-- PWA Install Banner -->
        <div id="install-banner" style="display: none; position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #78716c; color: white; padding: 15px 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; max-width: 90%; text-align: center;">
            <p style="margin: 0 0 10px 0; font-weight: bold;">üì± Als App installieren</p>
            <p style="margin: 0 0 15px 0; font-size: 14px;">Installieren Sie die Steinmetz-App f√ºr einfacheren Zugriff</p>
            <button id="install-button" style="background: white; color: #78716c; border: none; padding: 8px 16px; border-radius: 5px; font-weight: bold; cursor: pointer; margin-right: 10px;">Installieren</button>
            <button id="dismiss-button" style="background: transparent; color: white; border: 1px solid white; padding: 8px 16px; border-radius: 5px; cursor: pointer;">Sp√§ter</button>
        </div>

        <!-- Service Worker Registrierung -->
        <script>
            // Service Worker registrieren
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    navigator.serviceWorker.register('/sw.js')
                        .then((registration) => {
                            console.log('SW registered: ', registration);
                        })
                        .catch((registrationError) => {
                            console.log('SW registration failed: ', registrationError);
                        });
                });
            }

            // PWA Install Logic
            let deferredPrompt;
            const installBanner = document.getElementById('install-banner');
            const installButton = document.getElementById('install-button');
            const dismissButton = document.getElementById('dismiss-button');

            // Listen for beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
                console.log('beforeinstallprompt Event fired');
                e.preventDefault();
                deferredPrompt = e;
                
                // Check if user has dismissed the prompt before
                if (!localStorage.getItem('pwa-dismissed')) {
                    installBanner.style.display = 'block';
                }
            });

            // Install button click
            installButton.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`User response to the install prompt: ${outcome}`);
                    deferredPrompt = null;
                    installBanner.style.display = 'none';
                }
            });

            // Dismiss button click
            dismissButton.addEventListener('click', () => {
                installBanner.style.display = 'none';
                localStorage.setItem('pwa-dismissed', 'true');
            });

            // Listen for app installed event
            window.addEventListener('appinstalled', (evt) => {
                console.log('App was installed');
                installBanner.style.display = 'none';
            });

            // Check if app is already installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('App is running in standalone mode');
                installBanner.style.display = 'none';
            }
        </script>

        <a
            id="emergent-badge"
            target="_blank"
            href="https://app.emergent.sh/?utm_source=emergent-badge"
            style="
                display: flex !important;
                align-items: center !important;
                position: fixed !important;
                bottom: 20px;
                right: 20px;
                text-decoration: none;
                padding: 6px 10px;
                font-family: -apple-system, BlinkMacSystemFont,
                    &quot;Segoe UI&quot;, Roboto, Oxygen, Ubuntu, Cantarell,
                    &quot;Open Sans&quot;, &quot;Helvetica Neue&quot;,
                    sans-serif !important;
                font-size: 12px !important;
                z-index: 9999 !important;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
                border-radius: 8px !important;
                background-color: #ffffff !important;
                border: 1px solid rgba(255, 255, 255, 0.25) !important;
            "
        >
            <div
                style="display: flex; flex-direction: row; align-items: center"
            >
                <img
                    style="width: 20px; height: 20px; margin-right: 8px"
                    src="https://avatars.githubusercontent.com/in/1201222?s=120&u=2686cf91179bbafbc7a71bfbc43004cf9ae1acea&v=4"
                />
                <p
                    style="
                        color: #000000;
                        font-family: -apple-system, BlinkMacSystemFont,
                            &quot;Segoe UI&quot;, Roboto, Oxygen, Ubuntu,
                            Cantarell, &quot;Open Sans&quot;,
                            &quot;Helvetica Neue&quot;, sans-serif !important;
                        font-size: 12px !important;
                        align-items: center;
                        margin-bottom: 0;
                    "
                >
                    Made with Emergent
                </p>
            </div>
        </a>
    </body>
</html>